<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>index.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/paychex/core" target="_blank" class="menu-item" id="repository" >Source Code</a></h2><h3>Classes</h3><ul><li><a href="Action.html">Action</a><ul class='methods'><li data-type='method'><a href="Action.html#execute">execute</a></li><li data-type='method'><a href="Action.html#failure">failure</a></li><li data-type='method'><a href="Action.html#init">init</a></li><li data-type='method'><a href="Action.html#retry">retry</a></li><li data-type='method'><a href="Action.html#rollback">rollback</a></li><li data-type='method'><a href="Action.html#success">success</a></li></ul></li><li><a href="ActiveModelList.html">ActiveModelList</a><ul class='methods'><li data-type='method'><a href="ActiveModelList.html#active">active</a></li><li data-type='method'><a href="ActiveModelList.html#add">add</a></li><li data-type='method'><a href="ActiveModelList.html#clear">clear</a></li><li data-type='method'><a href="ActiveModelList.html#fire">fire</a></li><li data-type='method'><a href="ActiveModelList.html#items">items</a></li><li data-type='method'><a href="ActiveModelList.html#next">next</a></li><li data-type='method'><a href="ActiveModelList.html#on">on</a></li><li data-type='method'><a href="ActiveModelList.html#one">one</a></li><li data-type='method'><a href="ActiveModelList.html#prev">prev</a></li><li data-type='method'><a href="ActiveModelList.html#remove">remove</a></li><li data-type='method'><a href="ActiveModelList.html#resume">resume</a></li><li data-type='method'><a href="ActiveModelList.html#stop">stop</a></li></ul></li><li><a href="AutoResetSignal.html">AutoResetSignal</a><ul class='methods'><li data-type='method'><a href="AutoResetSignal.html#ready">ready</a></li><li data-type='method'><a href="AutoResetSignal.html#reset">reset</a></li><li data-type='method'><a href="AutoResetSignal.html#set">set</a></li></ul></li><li><a href="Cache.html">Cache</a><ul class='methods'><li data-type='method'><a href="Cache.html#get">get</a></li><li data-type='method'><a href="Cache.html#set">set</a></li></ul></li><li><a href="CountdownSignal.html">CountdownSignal</a><ul class='methods'><li data-type='method'><a href="CountdownSignal.html#decrement">decrement</a></li><li data-type='method'><a href="CountdownSignal.html#increment">increment</a></li><li data-type='method'><a href="CountdownSignal.html#ready">ready</a></li></ul></li><li><a href="DataDefinition.html">DataDefinition</a></li><li><a href="DataLayer.html">DataLayer</a><ul class='methods'><li data-type='method'><a href="DataLayer.html#createRequest">createRequest</a></li><li data-type='method'><a href="DataLayer.html#fetch">fetch</a></li><li data-type='method'><a href="DataLayer.html#setAdapter">setAdapter</a></li></ul></li><li><a href="EncryptionConfiguration.html">EncryptionConfiguration</a></li><li><a href="EventBus.html">EventBus</a><ul class='methods'><li data-type='method'><a href="EventBus.html#fire">fire</a></li><li data-type='method'><a href="EventBus.html#on">on</a></li><li data-type='method'><a href="EventBus.html#one">one</a></li><li data-type='method'><a href="EventBus.html#resume">resume</a></li><li data-type='method'><a href="EventBus.html#stop">stop</a></li></ul></li><li><a href="ExecutionPromise.html">ExecutionPromise</a></li><li><a href="FilteredModelList.html">FilteredModelList</a><ul class='methods'><li data-type='method'><a href="FilteredModelList.html#add">add</a></li><li data-type='method'><a href="FilteredModelList.html#clear">clear</a></li><li data-type='method'><a href="FilteredModelList.html#filterBy">filterBy</a></li><li data-type='method'><a href="FilteredModelList.html#fire">fire</a></li><li data-type='method'><a href="FilteredModelList.html#items">items</a></li><li data-type='method'><a href="FilteredModelList.html#on">on</a></li><li data-type='method'><a href="FilteredModelList.html#one">one</a></li><li data-type='method'><a href="FilteredModelList.html#remove">remove</a></li><li data-type='method'><a href="FilteredModelList.html#resume">resume</a></li><li data-type='method'><a href="FilteredModelList.html#stop">stop</a></li></ul></li><li><a href="GroupedModelList.html">GroupedModelList</a><ul class='methods'><li data-type='method'><a href="GroupedModelList.html#add">add</a></li><li data-type='method'><a href="GroupedModelList.html#clear">clear</a></li><li data-type='method'><a href="GroupedModelList.html#fire">fire</a></li><li data-type='method'><a href="GroupedModelList.html#groupBy">groupBy</a></li><li data-type='method'><a href="GroupedModelList.html#groups">groups</a></li><li data-type='method'><a href="GroupedModelList.html#items">items</a></li><li data-type='method'><a href="GroupedModelList.html#on">on</a></li><li data-type='method'><a href="GroupedModelList.html#one">one</a></li><li data-type='method'><a href="GroupedModelList.html#remove">remove</a></li><li data-type='method'><a href="GroupedModelList.html#resume">resume</a></li><li data-type='method'><a href="GroupedModelList.html#stop">stop</a></li></ul></li><li><a href="InvocationData.html">InvocationData</a></li><li><a href="ManualResetSignal.html">ManualResetSignal</a><ul class='methods'><li data-type='method'><a href="ManualResetSignal.html#ready">ready</a></li><li data-type='method'><a href="ManualResetSignal.html#reset">reset</a></li><li data-type='method'><a href="ManualResetSignal.html#set">set</a></li></ul></li><li><a href="Message.html">Message</a></li><li><a href="MetaData.html">MetaData</a></li><li><a href="ModelList.html">ModelList</a><ul class='methods'><li data-type='method'><a href="ModelList.html#add">add</a></li><li data-type='method'><a href="ModelList.html#clear">clear</a></li><li data-type='method'><a href="ModelList.html#fire">fire</a></li><li data-type='method'><a href="ModelList.html#items">items</a></li><li data-type='method'><a href="ModelList.html#on">on</a></li><li data-type='method'><a href="ModelList.html#one">one</a></li><li data-type='method'><a href="ModelList.html#remove">remove</a></li><li data-type='method'><a href="ModelList.html#resume">resume</a></li><li data-type='method'><a href="ModelList.html#stop">stop</a></li></ul></li><li><a href="NestedStartResult.html">NestedStartResult</a></li><li><a href="NestedTimingTracker.html">NestedTimingTracker</a><ul class='methods'><li data-type='method'><a href="NestedTimingTracker.html#child">child</a></li><li data-type='method'><a href="NestedTimingTracker.html#context">context</a></li><li data-type='method'><a href="NestedTimingTracker.html#error">error</a></li><li data-type='method'><a href="NestedTimingTracker.html#event">event</a></li><li data-type='method'><a href="NestedTimingTracker.html#start">start</a></li><li data-type='method'><a href="NestedTimingTracker.html#uuid">uuid</a></li></ul></li><li><a href="OrderedModelList.html">OrderedModelList</a><ul class='methods'><li data-type='method'><a href="OrderedModelList.html#add">add</a></li><li data-type='method'><a href="OrderedModelList.html#clear">clear</a></li><li data-type='method'><a href="OrderedModelList.html#fire">fire</a></li><li data-type='method'><a href="OrderedModelList.html#items">items</a></li><li data-type='method'><a href="OrderedModelList.html#on">on</a></li><li data-type='method'><a href="OrderedModelList.html#one">one</a></li><li data-type='method'><a href="OrderedModelList.html#orderBy">orderBy</a></li><li data-type='method'><a href="OrderedModelList.html#remove">remove</a></li><li data-type='method'><a href="OrderedModelList.html#resume">resume</a></li><li data-type='method'><a href="OrderedModelList.html#stop">stop</a></li></ul></li><li><a href="PagedModelList.html">PagedModelList</a><ul class='methods'><li data-type='method'><a href="PagedModelList.html#add">add</a></li><li data-type='method'><a href="PagedModelList.html#clear">clear</a></li><li data-type='method'><a href="PagedModelList.html#fire">fire</a></li><li data-type='method'><a href="PagedModelList.html#items">items</a></li><li data-type='method'><a href="PagedModelList.html#nextPage">nextPage</a></li><li data-type='method'><a href="PagedModelList.html#on">on</a></li><li data-type='method'><a href="PagedModelList.html#one">one</a></li><li data-type='method'><a href="PagedModelList.html#pageIndex">pageIndex</a></li><li data-type='method'><a href="PagedModelList.html#pageSize">pageSize</a></li><li data-type='method'><a href="PagedModelList.html#prevPage">prevPage</a></li><li data-type='method'><a href="PagedModelList.html#remove">remove</a></li><li data-type='method'><a href="PagedModelList.html#resume">resume</a></li><li data-type='method'><a href="PagedModelList.html#stop">stop</a></li></ul></li><li><a href="ProcessContext.html">ProcessContext</a><ul class='methods'><li data-type='method'><a href="ProcessContext.html#cancel">cancel</a></li><li data-type='method'><a href="ProcessContext.html#stop">stop</a></li><li data-type='method'><a href="ProcessContext.html#update">update</a></li></ul></li><li><a href="ProcessLogic.html">ProcessLogic</a><ul class='methods'><li data-type='method'><a href="ProcessLogic.html#contextFromArgs">contextFromArgs</a></li><li data-type='method'><a href="ProcessLogic.html#getInitialActions">getInitialActions</a></li><li data-type='method'><a href="ProcessLogic.html#getNextActions">getNextActions</a></li></ul></li><li><a href="ProcessTransition.html">ProcessTransition</a></li><li><a href="ProcessTransitions.html">ProcessTransitions</a></li><li><a href="Proxy.html">Proxy</a><ul class='methods'><li data-type='method'><a href="Proxy.html#apply">apply</a></li><li data-type='method'><a href="Proxy.html#url">url</a></li><li data-type='method'><a href="Proxy.html#use">use</a></li></ul></li><li><a href="ProxyRule.html">ProxyRule</a></li><li><a href="Request.html">Request</a></li><li><a href="Response.html">Response</a></li><li><a href="SelectionModelList.html">SelectionModelList</a><ul class='methods'><li data-type='method'><a href="SelectionModelList.html#add">add</a></li><li data-type='method'><a href="SelectionModelList.html#clear">clear</a></li><li data-type='method'><a href="SelectionModelList.html#fire">fire</a></li><li data-type='method'><a href="SelectionModelList.html#items">items</a></li><li data-type='method'><a href="SelectionModelList.html#on">on</a></li><li data-type='method'><a href="SelectionModelList.html#one">one</a></li><li data-type='method'><a href="SelectionModelList.html#remove">remove</a></li><li data-type='method'><a href="SelectionModelList.html#resume">resume</a></li><li data-type='method'><a href="SelectionModelList.html#selected">selected</a></li><li data-type='method'><a href="SelectionModelList.html#stop">stop</a></li><li data-type='method'><a href="SelectionModelList.html#toggle">toggle</a></li></ul></li><li><a href="Semaphore.html">Semaphore</a><ul class='methods'><li data-type='method'><a href="Semaphore.html#ready">ready</a></li><li data-type='method'><a href="Semaphore.html#release">release</a></li></ul></li><li><a href="Spy.html">Spy</a><ul class='methods'><li data-type='method'><a href="Spy.html#invokes">invokes</a></li><li data-type='method'><a href="Spy.html#onCall">onCall</a></li><li data-type='method'><a href="Spy.html#returns">returns</a></li><li data-type='method'><a href="Spy.html#throws">throws</a></li></ul></li><li><a href="SpyBehaviors.html">SpyBehaviors</a><ul class='methods'><li data-type='method'><a href="SpyBehaviors.html#invokes">invokes</a></li><li data-type='method'><a href="SpyBehaviors.html#returns">returns</a></li><li data-type='method'><a href="SpyBehaviors.html#throws">throws</a></li></ul></li><li><a href="SpyCall.html">SpyCall</a></li><li><a href="Store.html">Store</a><ul class='methods'><li data-type='method'><a href="Store.html#delete">delete</a></li><li data-type='method'><a href="Store.html#get">get</a></li><li data-type='method'><a href="Store.html#set">set</a></li></ul></li><li><a href="Tracker.html">Tracker</a><ul class='methods'><li data-type='method'><a href="Tracker.html#child">child</a></li><li data-type='method'><a href="Tracker.html#context">context</a></li><li data-type='method'><a href="Tracker.html#error">error</a></li><li data-type='method'><a href="Tracker.html#event">event</a></li><li data-type='method'><a href="Tracker.html#start">start</a></li><li data-type='method'><a href="Tracker.html#uuid">uuid</a></li></ul></li><li><a href="TrackingInfo.html">TrackingInfo</a></li><li><a href="Transformer.html">Transformer</a><ul class='methods'><li data-type='method'><a href="Transformer.html#request">request</a></li><li data-type='method'><a href="Transformer.html#response">response</a></li></ul></li><li><a href="UniqueModelList.html">UniqueModelList</a><ul class='methods'><li data-type='method'><a href="UniqueModelList.html#add">add</a></li><li data-type='method'><a href="UniqueModelList.html#clear">clear</a></li><li data-type='method'><a href="UniqueModelList.html#fire">fire</a></li><li data-type='method'><a href="UniqueModelList.html#items">items</a></li><li data-type='method'><a href="UniqueModelList.html#on">on</a></li><li data-type='method'><a href="UniqueModelList.html#one">one</a></li><li data-type='method'><a href="UniqueModelList.html#remove">remove</a></li><li data-type='method'><a href="UniqueModelList.html#resume">resume</a></li><li data-type='method'><a href="UniqueModelList.html#stop">stop</a></li><li data-type='method'><a href="UniqueModelList.html#uniqueBy">uniqueBy</a></li></ul></li><li><a href="UpdatingModelList.html">UpdatingModelList</a><ul class='methods'><li data-type='method'><a href="UpdatingModelList.html#add">add</a></li><li data-type='method'><a href="UpdatingModelList.html#clear">clear</a></li><li data-type='method'><a href="UpdatingModelList.html#fire">fire</a></li><li data-type='method'><a href="UpdatingModelList.html#items">items</a></li><li data-type='method'><a href="UpdatingModelList.html#merge">merge</a></li><li data-type='method'><a href="UpdatingModelList.html#on">on</a></li><li data-type='method'><a href="UpdatingModelList.html#one">one</a></li><li data-type='method'><a href="UpdatingModelList.html#remove">remove</a></li><li data-type='method'><a href="UpdatingModelList.html#resume">resume</a></li><li data-type='method'><a href="UpdatingModelList.html#stop">stop</a></li><li data-type='method'><a href="UpdatingModelList.html#uniqueBy">uniqueBy</a></li><li data-type='method'><a href="UpdatingModelList.html#upsert">upsert</a></li></ul></li><li><a href="XSRFOptions.html">XSRFOptions</a></li></ul><h3>Modules</h3><ul><li><a href="module-data.html">data</a><ul class='methods'><li data-type='method'><a href="module-data.html#.createDataLayer">createDataLayer</a></li><li data-type='method'><a href="module-data.html#.createProxy">createProxy</a></li></ul></li><li><a href="module-data_utils.html">data/utils</a><ul class='methods'><li data-type='method'><a href="module-data_utils.html#.falloff">falloff</a></li><li data-type='method'><a href="module-data_utils.html#.tokenize">tokenize</a></li><li data-type='method'><a href="module-data_utils.html#.withAuthentication">withAuthentication</a></li><li data-type='method'><a href="module-data_utils.html#.withCache">withCache</a></li><li data-type='method'><a href="module-data_utils.html#.withConnectivity">withConnectivity</a></li><li data-type='method'><a href="module-data_utils.html#.withDiagnostics">withDiagnostics</a></li><li data-type='method'><a href="module-data_utils.html#.withHeaders">withHeaders</a></li><li data-type='method'><a href="module-data_utils.html#.withRetry">withRetry</a></li><li data-type='method'><a href="module-data_utils.html#.withSignal">withSignal</a></li><li data-type='method'><a href="module-data_utils.html#.withTransform">withTransform</a></li><li data-type='method'><a href="module-data_utils.html#.withXSRF">withXSRF</a></li></ul></li><li><a href="module-errors.html">errors</a><ul class='methods'><li data-type='method'><a href="module-errors.html#.error">error</a></li><li data-type='method'><a href="module-errors.html#.fatal">fatal</a></li><li data-type='method'><a href="module-errors.html#.ignore">ignore</a></li><li data-type='method'><a href="module-errors.html#.rethrow">rethrow</a></li></ul></li><li><a href="module-index.html">index</a><ul class='methods'><li data-type='method'><a href="module-index.html#~buffer">buffer</a></li><li data-type='method'><a href="module-index.html#~eventBus">eventBus</a></li><li data-type='method'><a href="module-index.html#~invokeIf">invokeIf</a></li><li data-type='method'><a href="module-index.html#~parallel">parallel</a></li><li data-type='method'><a href="module-index.html#~sequence">sequence</a></li></ul></li><li><a href="module-models.html">models</a><ul class='methods'><li data-type='method'><a href="module-models.html#.modelList">modelList</a></li><li data-type='method'><a href="module-models.html#.withActive">withActive</a></li><li data-type='method'><a href="module-models.html#.withFiltering">withFiltering</a></li><li data-type='method'><a href="module-models.html#.withGrouping">withGrouping</a></li><li data-type='method'><a href="module-models.html#.withOrdering">withOrdering</a></li><li data-type='method'><a href="module-models.html#.withPaging">withPaging</a></li><li data-type='method'><a href="module-models.html#.withSelection">withSelection</a></li><li data-type='method'><a href="module-models.html#.withUnique">withUnique</a></li><li data-type='method'><a href="module-models.html#.withUpdating">withUpdating</a></li></ul></li><li><a href="module-process.html">process</a><ul class='methods'><li data-type='method'><a href="module-process.html#.action">action</a></li><li data-type='method'><a href="module-process.html#.dependencies">dependencies</a></li><li data-type='method'><a href="module-process.html#.process">process</a></li><li data-type='method'><a href="module-process.html#.run">run</a></li><li data-type='method'><a href="module-process.html#.transitions">transitions</a></li></ul></li><li><a href="module-signals.html">signals</a><ul class='methods'><li data-type='method'><a href="module-signals.html#.autoReset">autoReset</a></li><li data-type='method'><a href="module-signals.html#.countdown">countdown</a></li><li data-type='method'><a href="module-signals.html#.manualReset">manualReset</a></li><li data-type='method'><a href="module-signals.html#.semaphore">semaphore</a></li></ul></li><li><a href="module-stores.html">stores</a><ul class='methods'><li data-type='method'><a href="module-stores.html#.memoryStore">memoryStore</a></li></ul></li><li><a href="module-stores_utils.html">stores/utils</a><ul class='methods'><li data-type='method'><a href="module-stores_utils.html#.asDataCache">asDataCache</a></li><li data-type='method'><a href="module-stores_utils.html#.days">days</a></li><li data-type='method'><a href="module-stores_utils.html#.hours">hours</a></li><li data-type='method'><a href="module-stores_utils.html#.minutes">minutes</a></li><li data-type='method'><a href="module-stores_utils.html#.weeks">weeks</a></li><li data-type='method'><a href="module-stores_utils.html#.withEncryption">withEncryption</a></li><li data-type='method'><a href="module-stores_utils.html#.withExpiration">withExpiration</a></li><li data-type='method'><a href="module-stores_utils.html#.withPrefix">withPrefix</a></li></ul></li><li><a href="module-test.html">test</a><ul class='methods'><li data-type='method'><a href="module-test.html#.spy">spy</a></li></ul></li><li><a href="module-tracker.html">tracker</a><ul class='methods'><li data-type='method'><a href="module-tracker.html#.createTracker">createTracker</a></li><li data-type='method'><a href="module-tracker.html#.withNesting">withNesting</a></li></ul></li><li><a href="module-tracker_utils.html">tracker/utils</a><ul class='methods'><li data-type='method'><a href="module-tracker_utils.html#~withReplacement">withReplacement</a></li></ul></li></ul><h3>Externals</h3><ul><li><a href="external-Promise.html">Promise</a></li></ul><h3>Events</h3><ul><li><a href="ActiveModelList.html#~event:active-change">active-change</a></li><li><a href="FilteredModelList.html#~event:filter-change">filter-change</a></li><li><a href="GroupedModelList.html#~event:group-change">group-change</a></li><li><a href="ModelList.html#~event:items-add">items-add</a></li><li><a href="ModelList.html#~event:items-remove">items-remove</a></li><li><a href="OrderedModelList.html#~event:order-change">order-change</a></li><li><a href="PagedModelList.html#~event:page-change">page-change</a></li><li><a href="SelectionModelList.html#~event:selection-change">selection-change</a></li><li><a href="UniqueModelList.html#~event:unique-change">unique-change</a></li><li><a href="UpdatingModelList.html#~event:items-update">items-update</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Adapter">Adapter</a></li><li><a href="global.html#Fetch">Fetch</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">index.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import iteratee from 'lodash/iteratee.js';
import identity from 'lodash/identity.js';
import { rethrow } from './errors/index.js';

import {
    EventBus,
    InvocationData,
} from './types/index.js';

import {
    Semaphore,
    CountdownSignal,
    AutoResetSignal,
    ManualResetSignal,
} from './types/signals.js';

class UnusedEventBus extends EventBus {}
class UnusedSemaphore extends Semaphore {}
class UnusedCountdown extends CountdownSignal {}
class UnusedAutoReset extends AutoResetSignal {}
class UnusedManualReset extends ManualResetSignal {}
class UnusedInvocationData extends InvocationData {}

const stubPromise = () => Promise.resolve();

/**
 * Contains utilities that do not fall under any of the other module categories.
 *
 * @module index
 * @example
 * // combining eventBus, sequence, and parallel
 *
 * import { eventBus, sequence, parallel } from '@paychex/core';
 * import { localStore } from '@paychex/core/stores';
 *
 * // allow users to register concurrent event handlers;
 * // if any of these handlers throw an exception, the
 * // fired event will be rejected
 * const interceptors = parallel();
 * export function addInterceptor(fn) {
 *   interceptors.add(fn);
 *   return function remove() {
 *     interceptors.remove(fn);
 *   };
 * }
 *
 * // our internal event handler will run after any
 * // interceptors have run and be provided the results
 * // returned by all the interceptors
 * async function internalHandler(...args, lastResult) {
 *   // lastResult is array of results from interceptors
 * }
 *
 * // all interceptors will have access to our context
 * // object (e.g. `this.store` inside the subscriber)
 * const context = {
 *   store: localStore(),
 * };
 *
 * // execute handlers sequentially
 * // instead of in parallel
 * const bus = eventBus(context, sequence);
 *
 * bus.on('event', interceptors);    // run first
 * bus.on('event', internalHandler); // run second
 *
 * // we could also have written:
 * // const bus = eventBus(context);
 * // bus.on('event', sequence(interceptors, internalHandler));
 *
 * export async function run(...args) {
 *   return await bus.fire('event', ...args);
 * }
 */

/**
 * Creates a new {@link EventBus} to enable publish/subscribe behavior.
 *
 * @function eventBus
 * @param {*} [context=undefined] An optional `this` context to use when invoking subscribers.
 * @param {function} [mode=parallel] Optional factory to create an execution processor. The
 * default is {@link module:index~parallel parallel}, but you could also pass {@link module:index~sequence sequence}
 * or your own factory method. See the examples.
 * @returns {EventBus} An EventBus that provides publish/subscribe functionality.
 * @example
 * import { eventBus } from '@paychex/core';
 * import { tracker } from '~/tracking';
 *
 * const bus = eventBus();
 *
 * bus.on('event', function handler(arg1, arg2) {
 *   console.log(`received ${arg1} and ${arg2}`);
 *   return arg1 + arg2;
 * });
 *
 * // subscribers can be asynchronous
 * bus.on('event', async function handler(arg1, arg2) {
 *   const result = await someAsyncMethod(arg1);
 *   await someOtherAsyncMethod(result, arg2);
 *   return 'abc';
 * });
 *
 * // fire and forget
 * bus.fire('event', 1, 2);
 *
 * // catch any rejected promises returned by
 * // handlers (or errors thrown by handlers)
 * await bus.fire('event', 1, 2).catch(tracker.error);
 *
 * // examine the return values of handlers
 * const results = await bus.fire('event', 1, 2);
 * console.log(results); // [3, 'abc']
 * @example
 * // custom handler context
 *
 * import { eventBus } from '@paychex/core';
 *
 * const context = {
 *   key: 'value'
 * };
 *
 * const bus = eventBus(context); // subscriber context
 *
 * // NOTE: to access `this` in this handler
 * // we MUST use a real function and NOT the
 * // fat arrow syntax: () => {}
 * bus.on('custom-event', function handler() {
 *   console.log(this.key); // 'value'
 * });
 * @example
 * // sequential mode
 *
 * const bus = eventBus(null, sequence);
 *
 * bus.on('event', handler1); // runs first
 * bus.on('event', handler2); // runs after
 *
 * export async function trigger(...args) {
 *   await bus.fire('event', ...args);
 * }
 */
export function eventBus(context, mode = parallel) {

    let stopped = false;
    const subscribers = new Map();

    function on(event, subscriber) {
        const handler = subscriber.bind(context);
        const handlers = subscribers.get(event) || mode();
        handlers.add(handler);
        subscribers.set(event, handlers);
        return function off() {
            subscribers.get(event).remove(handler);
        };
    }

    function one(event, subscriber) {
        function handler(...args) {
            off();
            subscriber.apply(this, args);
        }
        const off = on(event, handler);
        return off;
    }

    function stop() {
        stopped = true;
    }

    function resume() {
        stopped = false;
    }

    function fire(event, ...args) {
        const handlers = subscribers.get(event) || stubPromise;
        return !stopped &amp;&amp; handlers(...args).catch(rethrow({ event, args }));
    }

    return {
        on,
        one,
        fire,
        stop,
        resume,
    };

}

/**
 * @async
 * @global
 * @callback ParallelFunction
 * @property {Function} add Adds one or more functions to the underlying {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set Set} and returns the original ParallelFunction for chaining.
 * @property {Function} remove Removes one or more functions from the underlying {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set Set} and returns the original ParallelFunction for chaining.
 * @property {Function} insert Adds one or more functions to the underlying {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set Set}, starting at the given index, and returns the original ParallelFunction for chaining.
 * @property {Function} clone Creates and returns a new copy of the ParallelFunction. Methods can be added or removed
 * from this function without modifying the original.
 * @param {...any} args The arguments to pass to the original functions.
 * @returns {Promise} A Promise resolved with the array of settled return
 * values or else rejecting with the first rejection reason or thrown error.
 * @example
 * const isValidUserName = parallel(isNonEmpty, allCharactersValid);
 *
 * // add more functions to the collection:
 * isValidUserName.add(isNotTaken, passesProfanityFilter);
 *
 * export async function validate(username) {
 *   try {
 *     const results = await isValidUserName(username);
 *     return result.every(Boolean);
 *   } catch (e) {
 *     return false;
 *   }
 * }
 */

/**
 * @async
 * @global
 * @callback SequentialFunction
 * @property {Function} add Adds one or more functions to the underlying {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set Set} and returns the original SequentialFunction for chaining.
 * @property {Function} remove Removes one or more functions from the underlying {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set Set} and returns the original SequentialFunction for chaining.
 * @property {Function} insert Adds one or more functions to the underlying {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set Set}, starting at the given index, and returns the original SequentialFunction for chaining.
 * @property {Function} clone Creates and returns a new copy of the SequentialFunction. Methods can be added or removed
 * from this function without modifying the original.
 * @param {...any} args The arguments to pass to the original functions.
 * @returns {Promise} A Promise resolved with the last function's settled
 * return value, or rejected if any function rejects or throws an error.
 * The functions will be passed the incoming arguments along with the value
 * returned by the previous function.
 * @example
 * // as a standalone function
 *
 * const process = sequence();
 *
 * async function handler1(...args, lastHandlerResult) {
 *   console.log(args, lastHandlerResult);
 *   await someAsyncMethod(...args);
 *   return 1;
 * }
 *
 * function handler2(...args, lastHandlerResult) {
 *   console.log(args, lastHandlerResult);
 *   return 2;
 * }
 *
 * process.add(handler1);
 * process.add(handler2);
 *
 * await process('abc', 'def'); // 2
 * // output from handler1: ['abc', 'def'], undefined
 * // output from handler2: ['abc', 'def'], 1
 * @example
 * // as a combination event handler
 *
 * function handler1(...args) {
 *   return 'some value';
 * }
 *
 * function handler2(...args, previousValue) {
 *   return previousValue === 'some value';
 * }
 *
 * const bus = eventBus();
 *
 * bus.on('event', sequence(handler1, handler2));
 * await bus.fire('event', 'arg1', 'arg2'); // [true]
 */

function getInvocationPattern(invoker) {
    return function pattern(...functions) {
        let set = new Set(functions);
        function invoke(...args) {
            const methods = Array.from(set);
            return invoker.call(this, methods, args);
        }
        invoke.add = (...fns) => {
            fns.forEach(set.add, set);
            return invoke;
        };
        invoke.remove = (...fns) => {
            fns.forEach(set.delete, set);
            return invoke;
        };
        invoke.insert = (index, ...fns) => {
            const methods = Array.from(set);
            methods.splice(index, 0, ...fns);
            set = new Set(methods);
            return invoke;
        };
        invoke.clone = () => getInvocationPattern(invoker)(...set);
        return invoke;
    };
}

/**
 * Invokes the specified functions in parallel, handling any
 * returned Promises correctly.
 *
 * @async
 * @function parallel
 * @param {...Function} fns The functions to invoke in parallel.
 * @returns {ParallelFunction} A function that will invoke the
 * given functions in parallel, waiting for any returned Promises
 * to settle, and either resolving with the array of settled return
 * values or else rejecting with the first rejection reason or
 * thrown error.
 * @example
 * const concurrent = parallel(fn1, fn2, fn3);
 * const results = await concurrent('abc', 123);
 * results.length; // 3
 * @example
 * // combining parallel() and sequence()
 *
 * const workflow = parallel(
 *   step1,
 *   sequence(step2a, step2b, step2c),
 *   sequence(step3a, step3b),
 *   step4,
 * );
 *
 * workflow.add(sequence(step5a, step5b));
 *
 * await workflow('some args');
 */
export const parallel = getInvocationPattern(function invoker(methods, args) {
    return Promise.all(methods.map(fn =>
        new Promise(resolve =>
            resolve(fn.apply(this, args)))));
});

/**
 * Invokes the specified functions in sequence, handling any
 * returned Promises correctly.
 *
 * @async
 * @function sequence
 * @param {...Function} fns The functions to invoke in sequence.
 * @returns {SequentialFunction} A function that will invoke the
 * given functions in sequence, waiting for any returned Promises
 * to settle, and either resolving with the last settled return
 * value or else rejecting with the first rejection reason or thrown
 * error.
 * @example
 * const bus = eventBus();
 * const checkDirty = parallel();
 *
 * bus.on('navigate', sequence(checkDirty, loadNewRoute));
 *
 * export function addDirtyChecker(fn) {
 *   checkDirty.add(fn);
 *   return function remove() {
 *     checkDirty.remove(fn);
 *   };
 * }
 *
 * export async function navigate(container, path) {
 *   await bus.fire('navigate', container, path);
 * }
 * @example
 * // combining parallel() and sequence()
 *
 * const workflow = parallel(
 *   step1,
 *   sequence(step2a, step2b, step2c),
 *   sequence(step3a, step3b),
 *   step4,
 * );
 *
 * workflow.add(sequence(step5a, step5b));
 *
 * await workflow('some args');
 */
export const sequence = getInvocationPattern(function invoker(methods, args){
    return methods.reduce((promise, fn) =>
        promise.then((result) => fn.call(this, ...args, result)),
            Promise.resolve());
});

/**
 * Function returned by {@link module:index~buffer buffer}.
 *
 * @async
 * @global
 * @callback BufferFunction
 * @param {...any} args The arguments to pass to the wrapped function.
 * @returns {Promise} A promise resolved when all the queued invocations
 * are complete, or rejected if any queued invocation throws an error or
 * returns a rejected Promise.
 */

/**
 * Filters the queued invocations when a {@link module:index~buffer buffer}'s
 * signals are ready.
 *
 * @global
 * @callback BufferFilter
 * @param {InvocationData[]} invocations The queued invocations.
 * @returns {InvocationData[]} A subset of queued invocations to invoke.
 * Filters can modify the invocation contexts and arguments.
 */

/**
 * Queues invocations of a function until the specified signals are ready.
 * Optionally, allows filtering the queued invocations or modifying their
 * arguments or `this` contexts.
 *
 * @function buffer
 * @param {Function} fn The function whose invocations should be buffered.
 * @param {Array.&lt;AutoResetSignal|ManualResetSignal|CountdownSignal|Semaphore>} signals The signals to wait on before ending buffering.
 * @param {BufferFilter} [filter=identity] Provides optional manipulation of the
 * buffered invocations. Passed an array of invocations and should return an
 * array of invocations. See the example for details.
 * @returns {BufferFunction} A function that will queue invocations while any of
 * the given signals are in a blocked state.
 * @example
 * // pause or resume tracking without losing events
 *
 * const { parallel, buffer } = require('@paychex/core');
 * const createTracker = require('@paychex/core/tracker');
 * const { manualReset } = require('@paychex/core/signals');
 *
 * const ready = manualReset(false);
 * const collectors = parallel();
 * const buffered = buffer(collectors, [ready]);
 *
 * export const tracker = createTracker(buffered);
 *
 * export function add(collector) {
 *   collectors.add(collector);
 * };
 *
 * export function pause() {
 *   ready.reset();
 * }
 *
 * export function start() {
 *   ready.set();
 * }
 * @example
 * // only run most recent invocation of a function
 * // if invoked multiple times while queued
 *
 * const signal = manualReset(true);
 *
 * function onlyMostRecent(invocations) {
 *   return invocations.slice(-1);
 * }
 *
 * async function loadData(arg) {
 *   try {
 *     await signal.ready();
 *     // make data call here
 *   } finally {
 *     signal.set();
 *   }
 * }
 *
 * export const load = buffer(loadData, [signal], onlyMostRecent);
 *
 * // consumer:
 * load(...); // runs, queues future calls until finished
 * load(...); // will be queued, then dropped in favor of most recent call
 * load(...); // will be queued, then run after first load completes
 */
export function buffer(fn, signals, filter = identity) {
    const queue = [];
    const ready = (signal) => signal.ready();
    const invoke = ([ctx, args]) =>
        new Promise((resolve) =>
            resolve(fn.apply(ctx, args)));
    return async function buffered(...args) {
        queue.push([this, args]);
        await Promise.all(signals.map(ready));
        await Promise.all(filter(queue.splice(0)).map(invoke));
    };
}

/**
 * Conditionally invokes the supplied function if the given predicate returns `true`.
 *
 * @function invokeIf
 * @param {Function} fn The function to invoke conditionally.
 * @param {Function} predicate A predicate function that returns `true` or `false`
 * depending on whether the passed function should be invoked. Will be called with
 * the original set of arguments and context.
 * @returns {Function} A function that will invoke `fn` only if `predicate` returns `true`.
 * @example
 * const collectors = parallel();
 *
 * collectors.add(console.log);
 * collectors.add(gaCollector(window.ga));
 *
 * function isEvent(item) {
 *   return item.type === 'event';
 * }
 *
 * const tracker = createTracker(invokeIf(collectors, isEvent));
 *
 * // we could also use lodash iteratee syntax:
 * const tracker = createTracker(invokeIf(collectors, { type: 'event' }));
 * const tracker = createTracker(invokeIf(collectors, ['type', 'event']));
 */
export function invokeIf(fn, predicate) {
    const pred = iteratee(predicate);
    return function conditional(...args) {
        if (pred.apply(this, args)) {
            return fn.apply(this, args);
        }
    };
}</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>
